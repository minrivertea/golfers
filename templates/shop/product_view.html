{% extends "base.html" %}
{% load thumbnail i18n %}

{% block extrajs %}
<script type="text/javascript" src="/js/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
<script type="text/javascript">

$('#notify-form').submit(function() {
		    $('#notify-form').css('opacity', '0.5');
		    $('#loading').toggle();
		    $.ajax({  
	    	    type: "POST",  
	    	    data: $('#notify-form').serialize(), 
	    	    url: "{% url notify_signup product.slug %}",  
	    	    cache: false,  
	   		    dataType: "html",  
	    	    success: function(data, textStatus) {
	    	    	$('form#notify-form').replaceWith(data);
	    	    	$('#loading').toggle();
	    	    }
    		}); 
			return false;	
		});

$(document).ready(function() {

	/* Apply fancybox to multiple items */
	$("a.group").fancybox({});
	
});

</script>
{% endblock %}

{% block metadescription %}{% if product.meta_description %}{{ product.meta_description }}{% else %}{{ product.long_description }}{% endif %}{% endblock %}

{% block extracss %}
<link rel="stylesheet" href="/css/fancybox/jquery.fancybox-1.3.4.css" type="text/css" media="screen" />
<style type="text/css">
  
  .right p {
    margin: 0; 
  }
  
  h1 {
    margin: 0 0 10px 0; 
  }
  
  #top {
    width: 100%;
    float: left;
    margin: 0px 0 0px;	
  }
  
  #top #topleft {
    width: 550px;
    float: left;
    margin-right: 30px;
  }
  
  #top #topright {
    float: left;
    width: 320px;	
  }
  
  #top #topright p {
  	font-weight: ;
  	font-size: 16px;
  	line-height: 1.6em;
  	margin: 0 0 20px;
  }
  
  #top #topright ul {
    list-style-type: none;
    margin: 0;
    padding-left: 0;
  }
  
  #top #topright ul li {
    float: left;
    padding: 10px 0;
    border-bottom: 1px solid #333;
    font-weight: 100; 
    width: 100%;
    text-align: right;
    font-size: 16px;
  }
  
#top .prices {
    float: left;
    font-size: 24px;
    font-weight: normal;
    margin-bottom: 15px;
    margin-top: 20px;
    padding: 0px;
    width: 100%;
    position: relative;
}


#top .prices .price span.strikethrough {
    color: #999;
    font-size: 15px;
    font-weight: normal;
    text-decoration: line-through;
    margin-left: 5px;
}
  
  
#top .prices a.button {
    float: right;
    padding-bottom: 10px;
    padding-top: 10px;
    width: 75%;
    text-align: right;
}
   
  
#message {
    background-color: #897963;
    border-radius: 4px 4px 4px 4px;
    font-size: 15px;
    font-weight: 100;
    padding: 5px 15px;
    text-align: right;
    float: right;
    position: relative;
}

#message:before {
    border-color: #897963 rgba(0, 0, 0, 0) rgba(0, 0, 0, 0);
    border-style: solid solid none;
    border-width: 10px 10px 0px;
    content: " ";
    display: block;
    position: absolute;
    right: 20px;
    bottom: -10px;
}
  
  span.red {color: #BD1B30;}
  
  .product_photos_small {
    margin-bottom: 20px;	
  }

#notify-form {
  float: left;
  width: 290px;
  background-color: #897963;
  padding: 10px 15px 15px;
  margin: 20px 0 20px 0;	
}  

#top #topright #notify-form p {
  margin: 0 0 5px 0;	
  float: left;
  width: 100%;
}

#notify-form input {
  border: none;
  font-size: 16px;
  padding: 3px 8px 5px;
  border: 1px solid #e1e1e1;
  float: left;
  width: 195px;
}

#notify-form input.button {
  border-left: none;
  font-size: 14px;
  padding: 4px 8px 5px;	
  width: auto;
}

#notify-form #loading {
  display: none;	
}

#notify-form .message {
  font-weight: bold;
  color: #BD1B30;	
}

#top #topright p.preorder {
  background: #BD1B30;
  padding: 5px 10px;
  color: #fff;
  float: left;
  font-size: 12px;
  margin: 10px 0 0;
  border-radius: 5px;
}

.red {
  color: red;   
}


.right ul.reviews li {
    background: none repeat scroll 0 0 #222222;
    color: #999999;
    font-size: 14px;
    line-height: 1.6em;
    margin: 0 0 15px;
    padding: 10px 15px;
    position: relative;
}

.right ul.reviews p {
  font-size: 14px;   
}

.right ul.reviews li span.name {
  color: #fff;
  font-size: 16px;   
}

.right ul.reviews li:before {
    border-color: rgba(0, 0, 0, 0) #222 rgba(0, 0, 0, 0) #0000FF;
    border-style: solid;
    border-width: 15px 15px 15px 0;
    content: " ";
    display: block;
    left: -15px;
    position: absolute;
    top: 20px;
    z-index: 20;
}

#recommended {
  float: left;
  width: 100%;   
}

#recommended > div {
  float: left;
  width: 210px;
  height: 200px;
  margin: 0 20px 0 0; 
  position: relative;  
}

#recommended > div img {
  width: 210px;
  height: 140px;
  float: left;   
}

#recommended > div:last-child {
  margin-right: 0;  
} 

#recommended > div:hover img {
  opacity: 0.8;   
}

#recommended > div h4 {
  border: none;
  margin: 0;
  padding: 0;   
}

ul.social {
  position: absolute;
  top: 25px;
  right: 0;
  list-style-type: none;
  padding: 0;
  margin: 0;   
}

ul.social li {
  float: left;
  width: 80px;    
}

ul.social li#google {
  width: 65px;   
}
/* IMPORTANT - THIS FIXES PROBLEM OF SOCIAL ICONS CHANGING WIDTH OF PAGE */
iframe[id^="oauth2relay"] { 
    left: auto !important; 
    right: 0px !important; 
}

</style>
{% endblock %}


{% block pagetitle %} {{ product.name }}{% endblock %}

{% block content %}
<div id="feature">	

	
	<h1>{{ product.name }}</h1>

	<div id="top">
		<div id="topleft">
		{% thumbnail product.image "550" crop="center" as im %}
		<img class="main" alt="a picture of {{ product.name }}" title="{{ product.description }}" src="{{ im.url }}"/>
		{% endthumbnail %}
		
		<div id="product-photos-small">	
			{% if product.image_2 %}
				{% thumbnail product.image_2 "550" crop="" as im_large %}
				<a class="group" href="{{ im_large.url }}" rel="group1" title="{{ product.image_2_caption }}">
					{% thumbnail product.image_2 "80x80" crop="center" as im %}
					<img class="product-small" alt="a picture of {{ product.name }}" title="{{ product.description }}" src="{{ im.url }}"/>
					{% endthumbnail %}
				</a>
				{% endthumbnail %}
			{% endif %}
			
			{% if product.image_3 %}
			    {% thumbnail product.image_3 "550" crop="" as im_large %}
				<a class="group"  href="{{ im_large.url }}" rel="group1" title="{{ product.image_3_caption }}">
				    {% thumbnail product.image_3 "80x80" crop="center" as im %}
				    <img class="product-small" alt="a picture of {{ product.name }}" title="{{ product.description }}" src="{{ im.url }}"/>
				    {% endthumbnail %}
				
				</a>
				{% endthumbnail %}
			{% endif %}
			{% if product.image_4 %}
			    {% thumbnail product.image_4 "550" crop="" as im_large %}
				<a class="group" href="{{ im_large.url }}" rel="group1" title="{{ product.image_4_caption }}">
				    {% thumbnail product.image_4 "80x80" crop="center" as im %}
				    <img class="product-small" alt="a picture of {{ product.name }}" title="{{ product.description }}" src="{{ im.url }}"/>
				    {% endthumbnail %}
				</a>
				{% endthumbnail %}
			{% endif %}
			{% if product.image_5 %}
			    {% thumbnail product.image_5 "550" crop="" as im_large %}
				<a class="group"  href="{{ im_large.url }}" rel="group1" title="{{ product.image_5_caption }}">
				    {% thumbnail product.image_5 "80x80" crop="center" as im %}
				<img class="product-small" alt="a picture of {{ product.name }}" title="{{ product.description }}" src="{{ im.url }}"/>
				{% endthumbnail %}
				</a>
				{% endthumbnail %}
			{% endif %}
			</div>	
		
		
		</div>
		
		<div id="topright">
			{% if product.long_description %}
			{{ product.long_description|safe }}
			{% endif %}
			
			{% if not prices %}
				<form action="{% url notify_signup product.slug %}" type="post" id="notify-form">
					<p>{% trans 'Sorry, this product is not in stock now - would you like to be emailed when it is?' %}</p>
					<input class="clearMeFocus" type="text" title="Your email address" name="email" id="id_email" value=""/>
					<input type="submit" class="button" value="Signup now"/>
					<img src="/images/loading.gif" id="loading"/>
				</form>
			{% endif %}
			
			
			
			{% if message %}
         	<div id="message">
         	  <strong>{% blocktrans with product.name as name %}1 x {{ name }} added to your basket!{% endblocktrans %}
         	</div>
         	{% endif %}
			
			
			
			{% if prices %}
				{% for price in prices %}
					<div class="prices">
						<a class="button arrow price" href="{% url add_to_basket price.id %}">
					        <span class="price">
					        {{ price.currency.symbol }}{{ price.price }}
					           {% if price.original_price %}
					           <span class="strikethrough">
					               {{ price.currency.symbol }}{{ price.original_price }}
					           </span>
					           {% endif %}
					        </span>
    						{% trans 'Add to basket' %}
						
						</a>				
					</div>
				{% endfor %}		      
			{% endif %}				
			
			{% comment "leaving it here because it might come back" %}
			{% if product.slug == _('proreturn-golf-practice-net') %}
				{% if countrycode in europe_and_uk or countrycode == 'UK' %}
				    <p class="red">{% trans 'Please note that we are currently out of stock until end of August. You can pre-order now with free shipping.' %}</p>
				{% endif %}
								
		    {% endif %}
		
		      {% get_current_language as LANG %}
				{% if countrycode == 'FR' and LANG == 'fr' %}
				    <p class="red">Nous sommes en rupture de stock jusqu'au 1er Septembre 2013. Payez aujourd'hui et beneficiex d'une livraison gratuite en France metropolitaine. Merci pour votre patience.</p>
				{% endif %}
		      {% endcomment %}
		
		</div>		
		
		
	</div>
	
	<div class="hr"></div>
	

	<div class="left">
		{{ product.body_text|safe }}	
  	</div>		

	<div class="right">
		<ul class="reviews">
			{% for review in reviews %}
			<li>{{ review.text|safe }} <span class="name">{{ review.owner }}</span></li>
			{% endfor %}
		</ul>
	</div>
	
	<div class="hr"></div>

    <div id="recommended">
        <h3>{% trans 'Also recommended for you' %}</h3>
        {% for x in recommended %}
        <div>
            <a href="{{ x.get_absolute_url }}"><span class="link"></span></a>
            {% thumbnail x.image "210x140" crop="center" as im %}
            <img src="{{ im.url }}" />
            {% endthumbnail %}
            <h4>{{ x.name }}</h4>
        </div>
        {% endfor %}
    </div>
    
    
    {% if ga_is_on %}
    <ul class="social">
		<li id="google">
			<div class="g-plusone" data-size="medium"></div>
			<!-- Place this tag after the last +1 button tag. -->
            <div style="display: none; width: 0;">
            <script type="text/javascript">
              (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
              })();
            </script>
            </div>
		</li>
		<li id="twitter">
		      <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{ site_url }}{{ product.get_absolute_url }}" data-text="I love this {{ product.name }}" data-size="small">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
		
		</li>
    	<li id="facebook">
		    <div id="fb-root"></div>
		    <script src="http://connect.facebook.net/en_US/all.js#appId=234100573279411&amp;xfbml=1"></script>
		    <fb:like href="{{ site_url }}{{ product.get_absolute_url }}" send="false" layout="button_count" width="80" show_faces="true" font="">
		    </fb:like>
		</li>
	</ul>
	{% else %}
	<ul class="social"><li><img src="/images/debug_social.jpg" /></li></ul>
	{% endif %}

</div>

	

{% endblock %}
